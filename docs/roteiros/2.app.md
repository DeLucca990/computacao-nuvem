---
title: Computação em Nuvem
author: Tiago Demay
---

# Deployment Orchestration


## Utilizando a infraestrutura Bare Metal com o Juju

Vamos utilizar o Juju para deploy de **uma** das arquiteturas abaixo.

As aplicações que vamos utilizar são:

* [Grafana](https://grafana.com/) junto com o [Prometheus](https://prometheus.io/)

* [Wordpress](https://wordpress.com/) junto com o [MySQL](https://www.mysql.com/)

## Faca o deploy da Aplicacao Grafana e Prometheus

### Deploy Grafana e Prometheus

O  [Grafana](https://grafana.com/) é uma plataforma de código aberto que simplifica a apresentação visual de dados, como gráficos e painéis, facilitando a compreensão em tempo real de sistemas e informações.

Para funcionar, o Grafana requer um banco de dados para armazenar configurações, metadados e informações relacionadas à exibição de dados em seus painéis e gráficos. Ele é compatível com vários bancos de dados, como Prometheus, MySQL, PostgreSQL, InfluxDB, SQLite3 e outros. Neste contexto, estamos utilizando o **Prometheus** como banco de dados, mas você tem a flexibilidade de escolher outro se preferir.

* Instale a aplicação **charm** para utilizarmos, vamos baixar o charm do Grafana do repositório charm-hub.

??? info "Charm"
    O **charm** é como um pacote que contém instruções sobre como instalar e configurar um aplicativo, como o **Grafana**. Você simplesmente escolhe o **charm** do Grafana, define algumas configurações e o **Juju** cuida do restante, tornando o processo de implantação mais fácil e consistente em ambientes de nuvem. Entenda melhor sobre o que é o charm lendo a sua documentação [charm-hub](https://charmhub.io).

```$ sudo snap install charm --channel=2.x/stable --classic```

* Baixe o charm do <https://charmhub.io/grafana> usando o comando **charm pull**.
  * ```$ charm pull grafana```

* Também vamos utilizar o charm do [Prometheus](https://prometheus.io/)
  * ```$ charm pull prometheus2```

### Agora é só fazer o Deploy com o auxilio do **JUJU**

* Faça o deploy do charm **prometheus2**, para fazer deploy do charm local, use *juju deploy ./pasta*

### Deploy do charm **grafana**

* Ao realizar o Deploy do grafana, acompanhe o processo utilizando o comando `juju status`

Caso ocorra um erro durante a instalação (`hook failed: install`):
* Devemos acessar o log da aplicação via o comando `juju debug-log --replay --include grafana/2`

* Nos logs voce encontrará mais informações da causa do erro `NO_PUBKEY`
  * Ele ocorre, pois a chave GPG do repositório do grafana não está no seu servidor, quando o juju tenta fazer `apt-get update` o sistema não consegue verificar a autenticidade do repositório.

  * Para consertar devemos acessar o servidor do grafana e instalar a chave manualmente:

  ```
  juju ssh grafana/2
  wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
  sudo apt-get update
  ```

  Ao rodar os comandos acima, a chave será instalada no sistema. Aguarde alguns instantes e o processo de instalação do grafana seguirá normalmente. Acompanhe o andamento usando o comando `juju status`.

### Integrando Grafana com Prometheus

* Utilize a documentação encontrada no **README** do charm do grafana.

* Acesse o dashboard do Grafana do seu computador e verifique o funcionamento do sistema.

* Verifique se a integração foi feita corretamente. Para isso crie um dashboard dentro do grafana e adicione uma visualização (deve aparecer o prometheus como source).

!!! exercise
    Checkpoint-4

    1. De um print da tela do Dashboard do MAAS com as Maquinas e seus respectivos IPs.
    2. De um print de tela do comando "juju status" depois que o Grafana estiver "active". 
    3. De um print da tela do Dashboard do Grafana com o Prometheus aparecendo como source. 



### Limpeza de ambiente !!!

* Limpe o deploy do Juju usando o command: juju destroy-controller main
